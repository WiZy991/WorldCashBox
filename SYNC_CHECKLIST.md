# Чеклист для проверки синхронизации СБИС

## Текущая ситуация

✅ **Переменные окружения настроены:**
- `SBIS_SERVICE_KEY` - есть
- `SBIS_POINT_ID: 206` - есть
- `SBIS_PRICE_LIST_ID: 15` - есть
- `SBIS_WAREHOUSE_ID: 284a42ba-97cc-4d9c-98af-00000000100a` - есть
- `SBIS_WAREHOUSE_NAME: Толстого 32А` - есть

## Как работает синхронизация сейчас

1. **Поиск склада:**
   - Сначала система пытается найти склад по названию "Толстого 32А" через `sabyWarehouse.Read`
   - Если не найдено, использует `SBIS_WAREHOUSE_ID`
   - Если не указано ни название, ни ID, синхронизация остатков пропускается

2. **Синхронизация цен:**
   - Загружает все цены из прайс-листа СБИС
   - Ищет товары по `sbisId` (точное совпадение ID, код, артикул или название)
   - Обновляет цены найденных товаров

3. **Синхронизация остатков:**
   - Загружает остатки со склада
   - Обновляет `stock` и `inStock` для товаров

## Что проверить

### 1. Код обновлен на сервере?

```bash
# На сервере проверьте, что файл содержит поиск по названию
grep "Автоматический поиск склада по названию" app/api/sbis/prices/sync/route.ts
```

### 2. Переменные загружены в PM2?

```bash
pm2 env 0 | grep SBIS
```

Должны быть все переменные, включая `SBIS_WAREHOUSE_NAME: Толстого 32А`

### 3. Проверьте логи при синхронизации

```bash
# Запустите синхронизацию в админ-панели, затем проверьте логи
pm2 logs worldcashbox --lines 100
```

Ищите сообщения:
- `Автоматический поиск склада по названию: Толстого 32А`
- `✓ Склад автоматически найден по названию: ...`
- `Загружено X товаров из прайс-листа СБИС`
- `Пример структуры товара из СБИС`

### 4. У товаров указан sbisId?

В админ-панели (`/admin/products`) проверьте, что у товаров указан `sbisId` (ID или код товара из СБИС).

## Возможные проблемы

1. **Товары не находятся:**
   - Проверьте, что `sbisId` указан правильно
   - Проверьте логи - там будет структура товаров из СБИС
   - Возможно, нужно использовать другой идентификатор (не код, а ID)

2. **Склад не находится по названию:**
   - Проверьте точное название склада в СБИС
   - Возможно, нужно использовать точное совпадение
   - Проверьте логи на ошибки

3. **Остатки не синхронизируются:**
   - Убедитесь, что склад найден (проверьте логи)
   - Убедитесь, что у товаров указан `sbisId`

## Следующие шаги

1. Загрузите обновленный код на сервер
2. Перезапустите PM2: `pm2 restart ecosystem.config.js --update-env`
3. Попробуйте синхронизацию
4. Проверьте логи PM2 для диагностики
