export interface FAQ {
  question: string
  answer: string
  category: 'general' | 'equipment' | 'pricing' | 'support' | 'integration'
  keywords: string[]
}

export const faqData: FAQ[] = [
  {
    question: 'Какое оборудование подойдет для моего бизнеса?',
    answer: 'Я помогу подобрать оптимальное оборудование! Ответьте на несколько вопросов о вашем бизнесе, и я предложу персональное решение.',
    category: 'equipment',
    keywords: ['оборудование', 'подойдет', 'бизнес', 'какое', 'выбрать'],
  },
  {
    question: 'Сколько стоит автоматизация?',
    answer: 'Стоимость зависит от масштаба вашего бизнеса и выбранных решений. Базовые решения начинаются от 25 000 ₽, комплексная автоматизация - от 200 000 ₽. Давайте подберем решение под ваш бюджет!',
    category: 'pricing',
    keywords: ['стоит', 'цена', 'стоимость', 'сколько', 'бюджет', 'дорого'],
  },
  {
    question: 'Что входит в стоимость?',
    answer: 'В стоимость входит: оборудование (POS-терминалы, кассы, моноблоки), программное обеспечение, установка и настройка, обучение персонала, техническая поддержка. Для точного расчета стоимости под ваш бизнес - давайте подберем решение!',
    category: 'pricing',
    keywords: ['входит', 'в стоимость', 'что включает', 'что входит', 'состав'],
  },
  {
    question: 'Что такое iiko?',
    answer: 'iiko - это комплексная система управления рестораном. Она включает управление залом и кухней, учет продуктов, калькуляцию блюд, интеграцию с доставкой, управление персоналом и аналитику продаж. Стоимость от 5 000 ₽. Отлично подходит для ресторанов и кафе.',
    category: 'equipment',
    keywords: ['iiko', 'айко', 'программа', 'ресторан', 'кафе'],
  },
  {
    question: 'Что такое Битрикс24?',
    answer: 'Битрикс24 - это CRM система для управления бизнесом. Стоимость от 3 000 ₽. Включает управление клиентами, задачи, проекты, аналитику и интеграции. Подробнее на worldcashbox24.ru',
    category: 'general',
    keywords: ['битрикс24', 'битрикс', 'crm', 'система управления', 'worldcashbox24'],
  },
  {
    question: 'Сколько стоит Битрикс24?',
    answer: 'Битрикс24 - CRM система для управления бизнесом. Стоимость от 3 000 ₽. Подробная информация и консультация на worldcashbox24.ru',
    category: 'pricing',
    keywords: ['битрикс24 цена', 'битрикс24 стоимость', 'битрикс24 тариф', 'сколько стоит битрикс24'],
  },
  {
    question: 'Какие гарантии вы предоставляете?',
    answer: 'Мы предоставляем гарантию на все оборудование и услуги. Срок гарантии зависит от типа оборудования. Также мы обеспечиваем техническую поддержку и консультации.',
    category: 'support',
    keywords: ['гарантия', 'гарантии', 'поддержка', 'сервис'],
  },
  {
    question: 'Как происходит установка и настройка?',
    answer: 'Наши специалисты выполняют установку и настройку оборудования на вашем объекте. Мы также проводим обучение персонала и обеспечиваем техническую поддержку.',
    category: 'support',
    keywords: ['установка', 'настройка', 'монтаж', 'подключение'],
  },
  {
    question: 'Нужна ли интеграция с другими системами?',
    answer: 'Да, мы можем интегрировать оборудование с товароучетными системами, CRM (Битрикс24), системами доставки, iiko для ресторанов и другими сервисами. Интеграция настраивается индивидуально под ваши потребности.',
    category: 'integration',
    keywords: ['интеграция', 'подключение', 'синхронизация', 'системы'],
  },
  {
    question: 'Работаете ли вы с крупными компаниями?',
    answer: 'Да, мы работаем с компаниями любого масштаба - от малого бизнеса до крупных сетей. У нас есть опыт автоматизации сетей с множеством точек продаж.',
    category: 'general',
    keywords: ['крупные', 'сеть', 'компании', 'корпорации'],
  },
  {
    question: 'Какие способы оплаты доступны?',
    answer: 'Мы принимаем оплату наличными, банковским переводом, а также предлагаем рассрочку и лизинг для удобства наших клиентов.',
    category: 'pricing',
    keywords: ['оплата', 'платеж', 'рассрочка', 'лизинг', 'как оплатить'],
  },
  {
    question: 'Есть ли рассрочка?',
    answer: 'Да, мы предлагаем рассрочку и лизинг для удобства наших клиентов. Условия рассрочки обсуждаются индивидуально в зависимости от суммы заказа и вашего бизнеса.',
    category: 'pricing',
    keywords: ['рассрочка', 'рассрочку', 'лизинг', 'в рассрочку'],
  },
  {
    question: 'Сколько времени занимает внедрение?',
    answer: 'Сроки внедрения зависят от сложности проекта. Простые решения внедряются за 1-3 дня, комплексная автоматизация может занять 1-2 недели. Мы всегда согласовываем сроки с клиентом.',
    category: 'support',
    keywords: ['время', 'сроки', 'когда', 'быстро', 'долго'],
  },
  {
    question: 'Какое оборудование для ресторана?',
    answer: 'Для ресторанов и кафе мы предлагаем автоматизацию: работа зала и кухни, учет продуктов, калькуляция блюд и себестоимость, графики смен и мотивация персонала, система лояльности и служба доставки. Рекомендуем POS-моноблок POSCenter POS250 (от 55 000 ₽) с интеграцией iiko или Эвотор 7.3 (от 30 000 ₽) для небольших кафе.',
    category: 'equipment',
    keywords: ['ресторан', 'кафе', 'общепит', 'ресторанное', 'зал', 'кухня', 'столовая', 'кофейня', 'пекарня'],
  },
  {
    question: 'Какое оборудование для магазина?',
    answer: 'Для магазинов и аптек мы предлагаем автоматизацию с поддержкой ОФД, ЕГАИС, Меркурий, маркировки. Оснащение кассовых мест "под ключ", складской и бухучет, закупки, анализ продаж, отчетность в госорганы. Рекомендуем POS-терминал POSCenter Wise (от 45 000 ₽) или Эвотор 7.2/7.3 (от 25-30 000 ₽) для небольших точек.',
    category: 'equipment',
    keywords: ['магазин', 'розница', 'торговля', 'магазинное', 'торговая точка', 'аптека'],
  },
  {
    question: 'Какое оборудование для услуг?',
    answer: 'Для сферы услуг мы предлагаем: онлайн-запись клиентов, управление графиком сотрудников, программы лояльности, бухгалтерский учет, POS-терминалы для приема платежей. Подходят мобильные кассы: Эвотор 7.2 (от 25 000 ₽), Mindeo M50 (от 20 000 ₽) или POSCenter POS101 (от 35 000 ₽).',
    category: 'equipment',
    keywords: ['услуги', 'сервис', 'онлайн-запись', 'график сотрудников', 'программы лояльности'],
  },
  {
    question: 'Что такое ОФД?',
    answer: 'ОФД (Оператор Фискальных Данных) - это обязательная система передачи данных о продажах в налоговую. Все наши кассы поддерживают ОФД. Мы поможем с подключением и настройкой.',
    category: 'general',
    keywords: ['офд', 'оператор', 'фискальных', 'данных'],
  },
  {
    question: 'Что такое ЕГАИС?',
    answer: 'ЕГАИС - это система учета алкогольной продукции. Наше оборудование поддерживает интеграцию с ЕГАИС для работы с алкоголем. Мы поможем с регистрацией и настройкой.',
    category: 'general',
    keywords: ['егаис', 'алкоголь', 'алкогольная', 'продукция'],
  },
  {
    question: 'Что такое маркировка товаров?',
    answer: 'Маркировка товаров "Честный знак" - это обязательная система маркировки для многих категорий товаров. Мы предлагаем регистрацию вашего бизнеса в системе "Честный знак" и "ЕГАИС" под ключ. Помогаем с регистрацией, настройкой оборудования и обучением персонала.',
    category: 'general',
    keywords: ['маркировка', 'честный знак', 'маркировать', 'товары', 'под ключ'],
  },
  {
    question: 'Что такое ЕГАИС?',
    answer: 'ЕГАИС - это система учета алкогольной продукции. Мы помогаем с регистрацией в системе ЕГАИС, настройкой оборудования для работы с алкоголем и интеграцией с вашей товароучетной системой.',
    category: 'general',
    keywords: ['егаис', 'алкоголь', 'алкогольная', 'продукция', 'учет'],
  },
  {
    question: 'Что такое Меркурий?',
    answer: 'Меркурий - это система ветеринарного сопровождения для учета продукции животного происхождения. Мы помогаем с регистрацией в системе Меркурий и настройкой оборудования для работы с этой системой.',
    category: 'general',
    keywords: ['меркурий', 'ветеринарный', 'животного происхождения', 'продукция'],
  },
  {
    question: 'Какие услуги вы предоставляете?',
    answer: 'Мы предоставляем: подбор оборудования, установку и настройку, обучение персонала, техническую поддержку, интеграцию систем, регистрацию в ОФД/ЕГАИС/Честный знак/Меркурий, маркировку товаров под ключ, консультации по автоматизации. Решаем все в режиме одного окна.',
    category: 'support',
    keywords: ['услуги', 'что делаете', 'чем занимаетесь', 'сервисы', 'режим одного окна'],
  },
  {
    question: 'Какие услуги вы предоставляете?',
    answer: 'Мы предоставляем: подбор оборудования, установку и настройку, обучение персонала, техническую поддержку, интеграцию систем, регистрацию в ОФД/ЕГАИС/Честный знак, консультации по автоматизации.',
    category: 'support',
    keywords: ['услуги', 'что делаете', 'чем занимаетесь', 'сервисы'],
  },
  {
    question: 'Обучаете ли персонал?',
    answer: 'Да, мы обязательно проводим обучение персонала работе с оборудованием и программным обеспечением. Обучение входит в стоимость установки и настройки.',
    category: 'support',
    keywords: ['обучение', 'обучаете', 'персонал', 'обучить', 'тренинг'],
  },
  {
    question: 'Есть ли техническая поддержка?',
    answer: 'Да, мы обеспечиваем техническую поддержку всех наших клиентов. Вы всегда можете обратиться к нам за помощью в работе с оборудованием или программным обеспечением.',
    category: 'support',
    keywords: ['поддержка', 'техподдержка', 'помощь', 'техническая'],
  },
  {
    question: 'Какие системы можно интегрировать?',
    answer: 'Мы интегрируем с товароучетными системами, CRM (Битрикс24), системами доставки, iiko для ресторанов, 1С, и другими популярными сервисами. Интеграция настраивается под ваши потребности.',
    category: 'integration',
    keywords: ['интегрировать', 'какие системы', 'подключить', 'синхронизировать'],
  },
  {
    question: 'Сколько стоит оборудование?',
    answer: 'Стоимость оборудования зависит от типа и модели. Эвотор 7.2 - от 25 000 ₽, Эвотор 7.3 - от 30 000 ₽, POSCenter POS101 - от 35 000 ₽, POSCenter Wise - от 45 000 ₽, POSCenter POS250 - от 55 000 ₽. Давайте подберем оптимальный вариант для вашего бизнеса!',
    category: 'pricing',
    keywords: ['стоит оборудование', 'цена оборудования', 'стоимость кассы', 'цена терминала'],
  },
]

export function findAnswer(userQuestion: string): FAQ | null {
  const lowerQuestion = userQuestion.toLowerCase().trim()
  
  // Специальные случаи - точные совпадения
  if (lowerQuestion === 'iiko' || lowerQuestion === 'айко' || lowerQuestion.includes('iiko') || lowerQuestion.includes('айко')) {
    return faqData.find(f => f.keywords.includes('iiko')) || null
  }
  
  if (lowerQuestion.includes('что входит') || lowerQuestion.includes('что включает') || lowerQuestion.includes('входит в стоимость')) {
    return faqData.find(f => f.keywords.includes('входит')) || null
  }
  
  // Поиск по точному совпадению вопроса (приоритет)
  const exactMatch = faqData.find(faq => {
    const faqLower = faq.question.toLowerCase()
    return lowerQuestion === faqLower || 
           lowerQuestion.includes(faqLower) || 
           faqLower.includes(lowerQuestion)
  })
  
  if (exactMatch) {
    return exactMatch
  }
  
  // Улучшенный поиск по ключевым словам с приоритетом
  const matches = faqData.map(faq => {
    const matchCount = faq.keywords.filter(keyword => 
      lowerQuestion.includes(keyword)
    ).length
    
    // Дополнительные проверки
    const questionWords = lowerQuestion.split(/\s+/)
    const questionMatch = questionWords.filter(word => 
      faq.question.toLowerCase().includes(word) && word.length > 3
    ).length
    
    return {
      faq,
      score: matchCount * 2 + questionMatch
    }
  }).filter(m => m.score > 0).sort((a, b) => b.score - a.score)
  
  // Если есть хорошее совпадение (score >= 2), возвращаем его
  if (matches.length > 0 && matches[0].score >= 2) {
    return matches[0].faq
  }
  
  // Если есть хотя бы одно совпадение, возвращаем лучшее
  if (matches.length > 0) {
    return matches[0].faq
  }
  
  return null
}

export const quickQuestions = [
  'Какое оборудование подойдет?',
  'Сколько стоит автоматизация?',
  'Какие гарантии?',
  'Как происходит установка?',
  'Нужна ли интеграция?',
  'Работаете с крупными компаниями?',
  'Какие способы оплаты?',
  'Есть ли рассрочка?',
  'Какие сроки внедрения?',
  'Что входит в стоимость?',
  'Какие системы можно интегрировать?',
  'Сколько времени занимает установка?',
  'Обучаете ли персонал?',
  'Есть ли техническая поддержка?',
]

// Контекстные вопросы в зависимости от категории и темы разговора
export function getContextualQuestions(category?: string, conversationContext?: string[]): string[] {
  const allQuestions = quickQuestions
  
  // Если есть контекст разговора, анализируем его
  if (conversationContext && conversationContext.length > 0) {
    const contextText = conversationContext.join(' ').toLowerCase()
    
    // Определяем тему по ключевым словам
    if (contextText.includes('стоимость') || contextText.includes('цена') || contextText.includes('стоит') || contextText.includes('бюджет')) {
      return [
        'Какие способы оплаты?',
        'Есть ли рассрочка?',
        'Какие сроки внедрения?',
        'Что входит в стоимость?',
      ]
    }
    
    if (contextText.includes('оборудование') || contextText.includes('касса') || contextText.includes('терминал')) {
      return [
        'Какое оборудование подойдет?',
        'Сколько стоит оборудование?',
        'Какие гарантии на оборудование?',
        'Как происходит установка?',
      ]
    }
    
    if (contextText.includes('установка') || contextText.includes('настройка') || contextText.includes('монтаж')) {
      return [
        'Сколько времени занимает установка?',
        'Нужна ли подготовка помещения?',
        'Обучаете ли персонал?',
        'Какие гарантии?',
      ]
    }
    
    if (contextText.includes('интеграция') || contextText.includes('подключение') || contextText.includes('синхронизация')) {
      return [
        'Какие системы можно интегрировать?',
        'Сколько стоит интеграция?',
        'Как происходит интеграция?',
        'Сколько времени занимает?',
      ]
    }
    
    if (contextText.includes('гарантия') || contextText.includes('поддержка') || contextText.includes('сервис')) {
      return [
        'Какие гарантии предоставляете?',
        'Есть ли техническая поддержка?',
        'Как быстро реагируете на проблемы?',
        'Какие сроки ремонта?',
      ]
    }
    
    if (contextText.includes('срок') || contextText.includes('время') || contextText.includes('когда') || contextText.includes('быстро')) {
      return [
        'Сколько времени занимает внедрение?',
        'Когда можно начать?',
        'Какие сроки установки?',
        'Как быстро работает система?',
      ]
    }
    
    if (contextText.includes('оплата') || contextText.includes('платеж') || contextText.includes('рассрочка')) {
      return [
        'Какие способы оплаты?',
        'Есть ли рассрочка?',
        'Можно ли в лизинг?',
        'Какие условия рассрочки?',
      ]
    }
  }
  
  // Если есть категория, используем её
  if (category) {
    const contextual: Record<string, string[]> = {
      equipment: [
        'Какое оборудование подойдет?',
        'Сколько стоит оборудование?',
        'Какие гарантии на оборудование?',
        'Как происходит установка?',
      ],
      pricing: [
        'Какие способы оплаты?',
        'Есть ли рассрочка?',
        'Какие сроки внедрения?',
        'Что входит в стоимость?',
      ],
      support: [
        'Какие гарантии?',
        'Как происходит установка?',
        'Сколько времени занимает внедрение?',
        'Есть ли техническая поддержка?',
      ],
      integration: [
        'Какие системы можно интегрировать?',
        'Сколько стоит интеграция?',
        'Как происходит интеграция?',
        'Сколько времени занимает?',
      ],
    }
    
    return contextual[category] || allQuestions.slice(0, 4)
  }
  
  return allQuestions.slice(0, 4)
}

